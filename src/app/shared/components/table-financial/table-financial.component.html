<div class="financial-header container">
  <div class="financial-title">
    {{ data.name || "" }}
    <span *ngIf="this.isMobile">
      <span class="white">-</span>
      {{ data.describe }}
    </span>
  </div>

  <button
    *ngIf="!isAdding"
    mat-mini-fab
    color="primary"
    aria-label="Adicionar nova linha"
    (click)="changeAction()"
    matTooltip="Adicionar nova linha"
    matTooltipPosition="above"
  >
    <mat-icon>add</mat-icon>
  </button>
</div>

<div class="mat-elevation-z8 container">
  <table mat-table [dataSource]="dataSource" matSort #sort="matSort">
    <!-- ACTIONS -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewActions">
          <button
            mat-icon-button
            color="primary"
            (click)="save(row)"
            matTooltip="Salvar alterações"
            matTooltipPosition="above"
          >
            <mat-icon>save</mat-icon>
          </button>

          <button
            mat-icon-button
            color="warn"
            (click)="cancel(row)"
            matTooltip="Cancelar edição"
            matTooltipPosition="above"
          >
            <mat-icon>close</mat-icon>
          </button>
        </ng-container>

        <ng-template #viewActions>
          <button
            mat-icon-button
            color="primary"
            (click)="edit(row)"
            matTooltip="Editar registro"
            matTooltipPosition="above"
          >
            <mat-icon>edit</mat-icon>
          </button>

          <button
            mat-icon-button
            color="warn"
            (click)="delete(row)"
            matTooltip="Excluir registro"
            matTooltipPosition="above"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </ng-template>
      </td>
    </ng-container>

    <!-- DATE -->
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="date">Data</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewDate">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="date" [(ngModel)]="row.date" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewDate>
          {{ row.date ? (row.date | date: "dd/MM/yyyy") : "-" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- SEQUENCIAL -->
    <ng-container matColumnDef="sequencial_month">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="sequencial_month">
        Mês Seq.
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewSequencial">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.sequencial_month" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewSequencial>
          {{ row.sequencial_month || "-" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- COTAS INÍCIO -->
    <ng-container matColumnDef="quotas_start_month">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="quotas_start_month">
        Cotas (Ini. Mês)
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewCotasIni">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.quotas_start_month" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewCotasIni>
          {{ row.quotas_start_month || "-" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- VALOR COTA -->
    <ng-container matColumnDef="quotas_value">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="quotas_value">
        Valor Cota
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewValorCota">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.quotas_value" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewValorCota>
          {{ row.quotas_value || 0 | currency: "BRL" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- PROVENTO UNIT -->
    <ng-container matColumnDef="unit_proven">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="unit_proven">
        Provento Unit.
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewUnitProven">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.unit_proven" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewUnitProven>
          {{ row.unit_proven || 0 | currency: "BRL" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- COTAS COMPRADAS -->
    <ng-container matColumnDef="purchased_quotas">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="purchased_quotas">
        Cotas Compradas
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewPurchased">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.purchased_quotas" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewPurchased>
          {{ row.purchased_quotas || 0 }}
        </ng-template>
      </td>
    </ng-container>

    <!-- VALOR COMPRA -->
    <ng-container matColumnDef="value_purchased_quotas">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="value_purchased_quotas">
        Valor de Compra
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewValuePurchase">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.value_purchased_quotas" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewValuePurchase>
          {{ row.value_purchased_quotas || 0 | currency: "BRL" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- PROVENTO MÊS -->
    <ng-container matColumnDef="month_value_provent">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="month_value_provent">
        Provento Mês
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewMonthProvent">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.month_value_provent" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewMonthProvent>
          {{ row.month_value_provent || 0 | currency: "BRL" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- COTAS PROV -->
    <ng-container matColumnDef="purchased_quotas_proven">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="purchased_quotas_proven">
        C. Com Prov.
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewPurchasedProven">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.purchased_quotas_proven" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewPurchasedProven>
          {{ row.purchased_quotas_proven || 0 }}
        </ng-template>
      </td>
    </ng-container>

    <!-- TOTAL PROV -->
    <ng-container matColumnDef="value_purchased_quotas_proven">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="value_purchased_quotas_proven">
        Total Prov.
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewTotalProven">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.value_purchased_quotas_proven" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewTotalProven>
          {{ row.value_purchased_quotas_proven || 0 | currency: "BRL" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- ACUMULADO -->
    <ng-container matColumnDef="accumulated_value_month">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="accumulated_value_month">
        Acumulado
      </th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewAccumulated">
          <mat-form-field class="compact-field">
            <input matInput type="number" [(ngModel)]="row.accumulated_value_month" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewAccumulated>
          {{ row.accumulated_value_month || 0 | currency: "BRL" }}
        </ng-template>
      </td>
    </ng-container>

    <!-- HEADER + ROWS -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <mat-paginator [pageSize]="5"></mat-paginator>
</div>