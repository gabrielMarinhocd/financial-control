<mat-card class="financial-card mat-elevation-z4">
  <mat-card-header>
    <mat-card-title style="text-transform: uppercase;">
      {{ data.name || '' }} - {{ data.describe }}
    </mat-card-title>

    <span class="spacer"></span>

    <button
      *ngIf="!isAdding"
      mat-raised-button
      color="primary"
      (click)="add()">
      <mat-icon>add</mat-icon>
      Adicionar
    </button>
  </mat-card-header>

  <mat-divider></mat-divider>
</mat-card>

<div class="mat-elevation-z8">
  <table mat-table [dataSource]="data.data!" matSort>

    <!-- EDIT -->
    <ng-container matColumnDef="edit">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row)">
          <button mat-icon-button color="primary" (click)="save()">
            <mat-icon>save</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="cancel()">
            <mat-icon>close</mat-icon>
          </button>
        </ng-container>
      </td>
    </ng-container>

    <!-- DATE -->
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Data</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewDate">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="date" [(ngModel)]="row.date">
          </mat-form-field>
        </ng-container>
        <ng-template #viewDate>
          {{ row.date | date:'dd/MM/yyyy' }}
        </ng-template>
      </td>
    </ng-container>

    <!-- SEQUENCIAL -->
    <ng-container matColumnDef="sequencial_month">
      <th mat-header-cell *matHeaderCellDef>Mês Seq.</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view1">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.sequencial_month">
          </mat-form-field>
        </ng-container>
        <ng-template #view1>{{ row.sequencial_month }}</ng-template>
      </td>
    </ng-container>

    <!-- MES REF -->
    <ng-container matColumnDef="quotas_start_month">
      <th mat-header-cell *matHeaderCellDef>Cotas (Ini. Mês)</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view2">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput [(ngModel)]="row.quotas_start_month">
          </mat-form-field>
        </ng-container>
        <ng-template #view2>{{ row.quotas_start_month }}</ng-template>
      </td>
    </ng-container>

    <!-- VALOR COTA -->
    <ng-container matColumnDef="quotas_value">
      <th mat-header-cell *matHeaderCellDef>Valor Cota</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view3">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.quotas_value">
          </mat-form-field>
        </ng-container>
        <ng-template #view3>{{ row.quotas_value | currency:'BRL' }}</ng-template>
      </td>
    </ng-container>

    <!-- PROVENTO UNIT -->
    <ng-container matColumnDef="unit_proven">
      <th mat-header-cell *matHeaderCellDef>Provento Unit.</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view4">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.unit_proven">
          </mat-form-field>
        </ng-container>
        <ng-template #view4>{{ row.unit_proven | currency:'BRL' }}</ng-template>
      </td>
    </ng-container>

    <!-- COTAS -->
    <ng-container matColumnDef="purchased_quotas">
      <th mat-header-cell *matHeaderCellDef>Cotas Compradas</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view5">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.purchased_quotas">
          </mat-form-field>
        </ng-container>
        <ng-template #view5>{{ row.purchased_quotas }}</ng-template>
      </td>
    </ng-container>

    <!-- VALOR COMPRA -->
    <ng-container matColumnDef="value_purchased_quotas">
      <th mat-header-cell *matHeaderCellDef>Valor de Compra</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view6">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.value_purchased_quotas">
          </mat-form-field>
        </ng-container>
        <ng-template #view6>{{ row.value_purchased_quotas | currency:'BRL' }}</ng-template>
      </td>
    </ng-container>

    <!-- PROVENTO MES -->
    <ng-container matColumnDef="month_value_provent">
      <th mat-header-cell *matHeaderCellDef>Provento Mês</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view7">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.month_value_provent">
          </mat-form-field>
        </ng-container>
        <ng-template #view7>{{ row.month_value_provent | currency:'BRL' }}</ng-template>
      </td>
    </ng-container>

    <!-- COTAS PROV -->
    <ng-container matColumnDef="purchased_quotas_proven">
      <th mat-header-cell *matHeaderCellDef>C. Com Prov.</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view8">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.purchased_quotas_proven">
          </mat-form-field>
        </ng-container>
        <ng-template #view8>{{ row.purchased_quotas_proven }}</ng-template>
      </td>
    </ng-container>

    <!-- TOTAL PROV -->
    <ng-container matColumnDef="value_purchased_quotas_proven">
      <th mat-header-cell *matHeaderCellDef>Total Prov.</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view9">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.value_purchased_quotas_proven">
          </mat-form-field>
        </ng-container>
        <ng-template #view9>{{ row.value_purchased_quotas_proven | currency:'BRL' }}</ng-template>
      </td>
    </ng-container>

    <!-- ACUMULADO -->
    <ng-container matColumnDef="accumulated_value_month">
      <th mat-header-cell *matHeaderCellDef>Acumulado</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else view10">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="number" [(ngModel)]="row.accumulated_value_month">
          </mat-form-field>
        </ng-container>
        <ng-template #view10>{{ row.accumulated_value_month | currency:'BRL' }}</ng-template>
      </td>
    </ng-container>

    <!-- HEADER ROW -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>

  <mat-paginator [pageSize]="5"></mat-paginator>
</div>