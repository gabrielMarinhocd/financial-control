<mat-card class="financial-card mat-elevation-z4">
  <mat-card-header>
    <mat-card-title style="text-transform: uppercase">
      {{ data.name || "" }} - {{ data.describe }}
    </mat-card-title>

    <span class="spacer"></span>

    <button
      *ngIf="!isAdding"
      mat-raised-button
      color="primary"
      (click)="changeAction()"
    >
      <mat-icon>add</mat-icon>
      Adicionar
    </button>
  </mat-card-header>

  <mat-divider></mat-divider>
</mat-card>

<div class="mat-elevation-z8">
  <table mat-table [dataSource]="dataSource" matSort #sort="matSort">

    <!-- ACTIONS -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewActions">
          <button mat-icon-button color="primary" (click)="save(row)" matTooltip="Salvar alterações" matTooltipPosition="above">
            <mat-icon>save</mat-icon>
          </button>

          <button mat-icon-button color="warn" (click)="cancel(row)" matTooltip="Cancelar edição" matTooltipPosition="above">
            <mat-icon>close</mat-icon>
          </button>
        </ng-container>

        <ng-template #viewActions>
          <button mat-icon-button color="primary" (click)="edit(row)" matTooltip="Editar registro" matTooltipPosition="above">
            <mat-icon>edit</mat-icon>
          </button>

          <button mat-icon-button color="warn" (click)="delete(row)" matTooltip="Excluir registro" matTooltipPosition="above">
            <mat-icon>delete</mat-icon>
          </button>
        </ng-template>
      </td>
    </ng-container>

    <!-- DATE -->
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="date">Data</th>
      <td mat-cell *matCellDef="let row">
        <ng-container *ngIf="isEditing(row); else viewDate">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput type="date" [(ngModel)]="row.date" />
          </mat-form-field>
        </ng-container>
        <ng-template #viewDate>
          {{ row.date ? (row.date | date: "dd/MM/yyyy") : '-' }}
        </ng-template>
      </td>
    </ng-container>

    <!-- SEQUENCIAL -->
    <ng-container matColumnDef="sequencial_month">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="sequencial_month">Mês Seq.</th>
      <td mat-cell *matCellDef="let row">
        {{ row.sequencial_month || '-' }}
      </td>
    </ng-container>

    <!-- COTAS INÍCIO -->
    <ng-container matColumnDef="quotas_start_month">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="quotas_start_month">Cotas (Ini. Mês)</th>
      <td mat-cell *matCellDef="let row">
        {{ row.quotas_start_month || '-' }}
      </td>
    </ng-container>

    <!-- VALOR COTA -->
    <ng-container matColumnDef="quotas_value">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="quotas_value">Valor Cota</th>
      <td mat-cell *matCellDef="let row">
        {{ row.quotas_value || 0 | currency: "BRL" }}
      </td>
    </ng-container>

    <!-- PROVENTO UNIT -->
    <ng-container matColumnDef="unit_proven">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="unit_proven">Provento Unit.</th>
      <td mat-cell *matCellDef="let row">
        {{ row.unit_proven || 0 | currency: "BRL" }}
      </td>
    </ng-container>

    <!-- COTAS -->
    <ng-container matColumnDef="purchased_quotas">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="purchased_quotas">Cotas Compradas</th>
      <td mat-cell *matCellDef="let row">
        {{ row.purchased_quotas || 0 }}
      </td>
    </ng-container>

    <!-- VALOR COMPRA -->
    <ng-container matColumnDef="value_purchased_quotas">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="value_purchased_quotas">Valor de Compra</th>
      <td mat-cell *matCellDef="let row">
        {{ row.value_purchased_quotas || 0 | currency: "BRL" }}
      </td>
    </ng-container>

    <!-- PROVENTO MÊS -->
    <ng-container matColumnDef="month_value_provent">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="month_value_provent">Provento Mês</th>
      <td mat-cell *matCellDef="let row">
        {{ row.month_value_provent || 0 | currency: "BRL" }}
      </td>
    </ng-container>

    <!-- COTAS PROV -->
    <ng-container matColumnDef="purchased_quotas_proven">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="purchased_quotas_proven">C. Com Prov.</th>
      <td mat-cell *matCellDef="let row">
        {{ row.purchased_quotas_proven || 0 }}
      </td>
    </ng-container>

    <!-- TOTAL PROV -->
    <ng-container matColumnDef="value_purchased_quotas_proven">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="value_purchased_quotas_proven">Total Prov.</th>
      <td mat-cell *matCellDef="let row">
        {{ row.value_purchased_quotas_proven || 0 | currency: "BRL" }}
      </td>
    </ng-container>

    <!-- ACUMULADO -->
    <ng-container matColumnDef="accumulated_value_month">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="accumulated_value_month">Acumulado</th>
      <td mat-cell *matCellDef="let row">
        {{ row.accumulated_value_month || 0 | currency: "BRL" }}
      </td>
    </ng-container>

    <!-- HEADER + ROWS -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <mat-paginator [pageSize]="5"></mat-paginator>
</div>